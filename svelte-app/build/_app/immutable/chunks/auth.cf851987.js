import{j as o}from"./singletons.fef9560c.js";import{w as h}from"./index.f2b4f84c.js";const v={duration:4e3,initial:1,next:0,pausable:!1,dismissable:!0,reversed:!1,intro:{x:256}};function m(){const{subscribe:a,update:c}=h(new Array),s={};let l=0;function f(t){return t instanceof Object}function d(t="default",n={}){return s[t]=n,s}function g(t,n){const r={target:"default",...f(t)?t:{...n,msg:t}},e=s[r.target]||{},i={...v,...e,...r,theme:{...e.theme,...r.theme},classes:[...e.classes||[],...r.classes||[]],id:++l};return c(u=>i.reversed?[...u,i]:[i,...u]),l}function p(t){c(n=>{if(!n.length||t===0)return[];if(typeof t=="function")return n.filter(e=>t(e));if(f(t))return n.filter(e=>e.target!==t.target);const r=t||Math.max(...n.map(e=>e.id));return n.filter(e=>e.id!==r)})}function _(t,n){const r=f(t)?t:{...n,id:t};c(e=>{const i=e.findIndex(u=>u.id===r.id);return i>-1&&(e[i]={...e[i],...r}),e})}return{subscribe:a,push:g,pop:p,set:_,_init:d}}const w=m();o.disable_scroll_handling;const y=o.goto;o.invalidate;const B=o.invalidateAll;o.preload_data;o.preload_code;o.before_navigate;o.after_navigate;const b=a=>w.push({msg:a,theme:{"--toastBackground":"green","--toastColor":"white","--toastBarBackground":"olive"}});async function x(a){{const s=await(await a("/api/login")).json();return b(`Server said: ${JSON.stringify(s)}`),"sub"in s?s:null}}async function I({fetch:a,route:c}){{const{id:s}=c;try{const l=await x(a);if(l===null)throw new Error("user not logged in");return l}catch{return console.log(`visiting ${s} which requires authentication, now redirecting to /login`),y("/login?next="+encodeURIComponent(s)),{}}}}export{x as a,y as g,B as i,I as r,b as s,w as t};
